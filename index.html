<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Managing Session For 3rd Party Services</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
</head>
<body>

<div class="container-fluid">
  <nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 h1">Apply request header values to start an auth session with 3rd party API</span>
  </nav>
  <div class="row m-2" style="height:700px">
     <div class="col border p-2">
        <form>
           <div class="form-group">
              <label for="xConsumerName">x-consumer-name</label>
              <input type="text" class="form-control" id="xConsumerName" placeholder="">
           </div>
           <div class="form-group">
              <label for="xRestVersion">x-broker-rest-version</label>
              <input type="text" class="form-control" id="xRestVersion" placeholder="">
           </div>
           <div class="form-group">
              <label for="xCorrelationId">x-correlation-id</label>
              <input type="text" class="form-control" id="xCorrelationId" placeholder="">
           </div>
           <div class="form-group">
              <label for="cookieData">Set cookie</label>
              <textarea class="form-control" id="cookieData" rows="12"></textarea>
           </div>
           <button id="startSessionBtn" type="button" class="btn btn-primary">Start Session</button>
           <button id="resetSessionBtn" type="button" class="btn btn-danger">Reset Session</button>
           <div id="sessionAlert" class="alert alert-success d-none mt-2" role="alert"></div>
        </form>
     </div>
     <div class="col border p-2">
        <form>
           <div class="form-group">
              <label for="exampleAPI">Example API</label>
              <input type="text" class="form-control" id="exampleAPI" placeholder="" value="/a/b/c" disabled>
           </div>
           <div class="form-group">
              <label for="responseData">Response</label>
              <textarea id="APIPayload" class="form-control" id="responseData" rows="19"></textarea>
           </div>
           <button type="button" id="validateSessionBtn" class="btn btn-primary">Validate API</button>
           <div id="payloadAlert" class="alert d-none mt-2" role="alert"></div>
        </form>
     </div>
  </div>
</div>

<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
 
  $('#xConsumerName').val('noop');
  $('#xRestVersion').val('v1.0');
 
  $('#startSessionBtn').click(function(){
 
     var xConsumerName = $('#xConsumerName').val();
     var xRestVersion = $('#xRestVersion').val();
     var xCorrelationId = $('#xCorrelationId').val();
     var cookieData = $('#cookieData').val();
    
     if(xConsumerName === '' || xRestVersion === '' || xCorrelationId === '' || cookieData === ''){
        $('#sessionAlert').addClass('alert-danger').removeClass('alert-success');
        $('#sessionAlert').html('Please set ALL session values!').removeClass('d-none');
        return;
     }
    
     $.post('/update', {
       name: xConsumerName,
       version: xRestVersion,
       correlation: xCorrelationId,
       cookie : cookieData
     }, function(data){
       $('#sessionAlert').addClass('alert-success').removeClass('alert-danger');
       $('#sessionAlert').html(data.message).removeClass('d-none');;
     });
  });
 
  $('#resetSessionBtn').click(function(){
     $.post('/update', {
       name: '',
       version: '',
       correlation: '',
       cookie : ''
     }, function(data, status){
       $('#sessionAlert').addClass('alert-success').removeClass('alert-danger');
       $('#sessionAlert').html('Session was successfully reseted!').removeClass('d-none');
     });
  });
 
  $('#validateSessionBtn').click(function(){
 
     var apiURL = '/api' + $('#exampleAPI').val();
          
     $.get(apiURL).done(function(data) {
        $('#APIPayload').val(JSON.stringify(data.payload));
        $('#payloadAlert').addClass('alert-success').removeClass('alert-danger');
        $('#payloadAlert').html('API successfully connected!').removeClass('d-none');
     })
     .fail(function(err) {
        $('#APIPayload').val('');
        $('#payloadAlert').html(err.responseJSON.message).removeClass('d-none');
        $('#payloadAlert').addClass('alert-danger').removeClass('alert-success');
     })
    
  });
});
</script>
</body>
</html>

